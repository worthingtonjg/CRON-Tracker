<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CRON Tracker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .scroll-list {
      max-height: 400px;
      overflow-y: auto;
    } 
  </style>
</head>
<body class="p-4">
  <div class="container">
    <h1 class="mb-4">CRON Tracker</h1>

    <!-- Tabs -->
    <ul class="nav nav-tabs" id="trackerTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="nutrients-tab" data-bs-toggle="tab" data-bs-target="#nutrients" type="button" role="tab">Tracked Nutrients</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="foods-tab" data-bs-toggle="tab" data-bs-target="#foods" type="button" role="tab">Allowed Foods</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="diary-tab" data-bs-toggle="tab" data-bs-target="#diary" type="button" role="tab">Food Diary</button>
      </li>
    </ul>

    <!-- Tracked Nutrients -->
    <div class="tab-content mt-3" id="trackerTabsContent">
      <div class="tab-pane fade show active" id="nutrients" role="tabpanel">
        <button class="btn btn-success mb-3" onclick="showNutrientForm()">Add Nutrient</button>

        <!-- Nutrient Form -->
        <div id="nutrientForm" class="edit-box" style="display: none;">
          <div class="mb-3">
            <label class="form-label">Nutrient Name</label>
            <input type="text" id="nutrientName" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label">Min Amount</label>
            <input type="number" id="nutrientMin" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label">Max Amount</label>
            <input type="number" id="nutrientMax" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label">Unit</label>
            <select id="nutrientUnit" class="form-select">
              <option value="mg">mg</option>
              <option value="mcg">mcg</option>
              <option value="IU">IU</option>
            </select>
          </div>
          <button class="btn btn-primary mb-3" onclick="saveNutrient()">Save Nutrient</button>
        </div>

        <!-- Nutrient List -->
        <ul class="list-group scroll-list" id="nutrientList"></ul>
      </div>

      <!-- Allowed Foods -->
      <div class="tab-pane fade" id="foods" role="tabpanel">
        <div class="mb-3">
          <label class="form-label">Food Name</label>
          <input type="text" id="foodName" class="form-control">
        </div>
        <div class="mb-3">
          <label class="form-label">Nutrient Amounts</label>
          <div id="foodNutrientInputs"></div>
        </div>
        <button class="btn btn-primary mb-3" onclick="addFood()">Add Food</button>
        <ul class="list-group" id="foodList"></ul>
      </div>

      <!-- Food Diary -->
      <div class="tab-pane fade" id="diary" role="tabpanel">
        <div class="mb-3">
          <label class="form-label">Select Food</label>
          <select id="foodSelect" class="form-select"></select>
        </div>
        <button class="btn btn-primary mb-3" onclick="addToDiary()">Add to Diary</button>
        <div id="diaryList" class="mt-3"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const nutrients = JSON.parse(localStorage.getItem('nutrients') || '{}');
    const foods = JSON.parse(localStorage.getItem('foods') || '{}');
    const diary = JSON.parse(localStorage.getItem('diary') || '[]');

    function saveData() {
      localStorage.setItem('nutrients', JSON.stringify(nutrients));
      localStorage.setItem('foods', JSON.stringify(foods));
      localStorage.setItem('diary', JSON.stringify(diary));
    }

    function renderNutrients() {
      const list = document.getElementById('nutrientList');
      list.innerHTML = '';
      Object.entries(nutrients).forEach(([name, {minTarget, maxTarget, unit}]) => {
        const range = maxTarget > 0
          ? `${minTarget}-${maxTarget}${unit}`
          : `${minTarget}${unit}`;
        
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.innerHTML = `
          <span>${name}: ${range}</span>
          <button class="btn btn-sm btn-danger" onclick="deleteNutrient('${name}')">Delete</button>
        `;
        list.appendChild(li);
      });
    }

    function renderFoodNutrientInputs() {
      const container = document.getElementById('foodNutrientInputs');
      container.innerHTML = '';

      Object.keys(nutrients).forEach(nutrientName => {
        const div = document.createElement('div');
        div.className = 'input-group mb-2';

        const label = document.createElement('span');
        label.className = 'input-group-text';
        label.textContent = nutrientName;

        const input = document.createElement('input');
        input.type = 'number';
        input.min = 0;
        input.step = 'any';
        input.className = 'form-control';
        input.id = `food-nutrient-${nutrientName}`;

        div.appendChild(label);
        div.appendChild(input);
        container.appendChild(div);
      });
    }

    function renderFoods() {
      const list = document.getElementById('foodList');
      const select = document.getElementById('foodSelect');
      list.innerHTML = '';
      select.innerHTML = '';
      Object.entries(foods).forEach(([name, nutrients]) => {
        const li = document.createElement('li');
        li.className = 'list-group-item';
        li.textContent = `${name} - Nutrients: ${JSON.stringify(nutrients)}`;
        list.appendChild(li);
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        select.appendChild(option);
      });

      renderFoodNutrientInputs();
    }

    function renderDiary() {
      const diaryDiv = document.getElementById('diaryList');
      diaryDiv.innerHTML = '';
      diary.forEach(entry => {
        const div = document.createElement('div');
        div.className = 'mb-2';
        div.textContent = `${entry.date} - ${entry.food}`;
        diaryDiv.appendChild(div);
      });
    }

    function showNutrientForm() {
      const form = document.getElementById('nutrientForm');
      if (form.style.display === 'none' || form.style.display === '') {
        form.style.display = 'block';
        document.getElementById('nutrientName').focus();
      } else {
        form.style.display = 'none';
      }
    }

    function saveNutrient() {
      const name = document.getElementById('nutrientName').value;
      const minTarget = parseFloat(document.getElementById('nutrientMin').value);
      const maxTarget = parseFloat(document.getElementById('nutrientMax').value);
      const unit = document.getElementById('nutrientUnit').value;
      if (name && !isNaN(minTarget) && !isNaN(maxTarget)) {
        nutrients[name] = { minTarget, maxTarget, unit };
        resetNutrientAdd();
        document.getElementById('nutrientName').focus();
        saveData();
        renderNutrients();
      }
    }

    function resetNutrientAdd()
    {
      document.getElementById('nutrientName').value = '';
      document.getElementById('nutrientMin').value = 0;
      document.getElementById('nutrientMax').value = 0;
      document.getElementById('nutrientUnit').value = '';
    }

    function deleteNutrient(name) {
      delete nutrients[name];
      saveData();
      renderNutrients();
    }

    function addFood() {
      const name = document.getElementById('foodName').value;
      try {
        const nutrients = JSON.parse(document.getElementById('foodNutrients').value);
        foods[name] = nutrients;
        saveData();
        renderFoods();
      } catch {
        alert('Invalid nutrient format. Use JSON like: {"Magnesium": 50}');
      }
    }

    function addToDiary() {
      const food = document.getElementById('foodSelect').value;
      const date = new Date().toISOString().split('T')[0];
      diary.push({ date, food });
      saveData();
      renderDiary();
    };

    resetNutrientAdd();
    renderNutrients();
    renderFoods();
    renderDiary();
  </script>
</body>
</html>
